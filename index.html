<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montbridge - Due Diligence & Valuation Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background: #fafbfc;
            color: #1a1a1a;
            line-height: 1.6;
            letter-spacing: -0.01em;
        }
        
        .header {
            background: #ffffff;
            color: #1a1a1a;
            padding: 0;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 32px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(0, 102, 204, 0.2);
        }
        
        .nav {
            display: flex;
            gap: 24px;
        }
        
        .nav-item {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            color: #6b7280;
            font-weight: 500;
            font-size: 14px;
        }
        
        .nav-item:hover {
            background: #f3f4f6;
            color: #0066cc;
        }
        
        .nav-item.active {
            background: #e6f0ff;
            color: #0066cc;
            font-weight: 600;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 40px;
        }
        
        .card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            margin-bottom: 24px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            transition: box-shadow 0.2s;
        }
        
        .card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .card-header {
            padding: 20px 28px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        
        .card-title {
            font-size: 17px;
            font-weight: 600;
            color: #111827;
            margin: 0;
            letter-spacing: -0.02em;
        }
        
        .card-content {
            padding: 28px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .metric-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 28px;
            text-align: left;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .metric-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
            letter-spacing: -0.03em;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 8px;
            padding: 60px 20px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #1890ff;
            background: #f0f8ff;
        }
        
        .upload-area.dragover {
            border-color: #1890ff;
            background: #e6f7ff;
        }
        
        .btn {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 102, 204, 0.2);
            letter-spacing: 0.3px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #0052a3 0%, #003d7a 100%);
            box-shadow: 0 4px 8px rgba(0, 102, 204, 0.3);
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        .hidden {
            display: none;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
            letter-spacing: -0.03em;
        }
        
        .alert {
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .alert-info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        
        .alert-success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        
        .alert-error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        
        .file-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .file-item {
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1890ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
        }
        
        .info-box {
            background: linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%);
            border-left: 4px solid #1890ff;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .info-box h4 {
            margin: 0 0 8px 0;
            color: #001529;
        }
        
        .info-box ul {
            margin: 8px 0 0 20px;
            line-height: 1.8;
        }
        
        .info-box code {
            background: rgba(255,255,255,0.7);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 13px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #001529;
            margin: 0 0 8px 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #001529;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .download-section {
            background: #f0f5ff;
            padding: 24px;
            border-radius: 8px;
            border: 2px solid #1890ff;
            margin-top: 24px;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        table th,
        table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        table td {
            color: #1f2937;
        }
        
        table tr:hover {
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">M</div>
                <div>
                    <h1 style="margin: 0; font-size: 20px; letter-spacing: -0.5px; font-weight: 700; color: #111827;">MONTBRIDGE</h1>
                    <p style="margin: 0; font-size: 10px; color: #6b7280; letter-spacing: 1.5px; font-weight: 500;">DUE DILIGENCE & VALUATION</p>
                </div>
            </div>
            <nav class="nav">
                <div class="nav-item" onclick="showSection('welcome')">Home</div>
                <div class="nav-item" onclick="showSection('upload')">Analysis</div>
                <div class="nav-item" onclick="showSection('dashboard')">Dashboard</div>
                <div class="nav-item" onclick="showSection('valuation')">Valuation</div>
                <div class="nav-item" onclick="showSection('risks')">Risk Assessment</div>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Welcome Section -->
        <section id="welcome" class="section">
            <div style="text-align: center; padding: 100px 20px 80px; background: #ffffff;">
                <div style="width: 72px; height: 72px; background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto 28px; font-size: 32px; font-weight: 700; color: white; box-shadow: 0 4px 12px rgba(0, 102, 204, 0.25);">M</div>
                <h1 style="font-size: 44px; margin: 0 0 8px 0; color: #111827; font-weight: 700; letter-spacing: -1.5px;">MONTBRIDGE</h1>
                <h2 style="font-size: 14px; margin: 0 0 40px 0; color: #6b7280; font-weight: 600; letter-spacing: 3px; text-transform: uppercase;">Due Diligence & Valuation Platform</h2>
                <p style="font-size: 18px; color: #4b5563; max-width: 680px; margin: 0 auto 48px; line-height: 1.7; font-weight: 400;">
                    Enterprise-grade investment analysis platform for private equity firms evaluating 
                    small and medium-sized business acquisitions.
                </p>
                <button class="btn" onclick="openCompanyModal()" style="font-size: 14px; padding: 14px 40px; text-transform: uppercase; letter-spacing: 1.2px;">
                    Begin Analysis
                </button>
            </div>

            <!-- Market Watcher Widget -->
            <div class="card" style="margin-top: 40px; border: 1px solid #0066cc;">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);">
                    <h3 class="card-title" style="color: #0066cc;">Global Market Overview</h3>
                    <div>
                        <select id="marketSelector" onchange="switchMarket(this.value)" style="padding: 8px 16px; border: 1px solid #d1d5db; border-radius: 6px; background: white; color: #374151; font-size: 14px; font-weight: 500; cursor: pointer;">
                            <option value="us">US Markets</option>
                            <option value="europe">European Markets</option>
                            <option value="asia">Asian Markets</option>
                            <option value="tech">Technology Sector</option>
                        </select>
                    </div>
                </div>
                <div class="card-content">
                    <div id="marketData" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <!-- Market data will be populated here -->
                    </div>
                    <div style="margin-top: 20px; text-align: center; color: #9ca3af; font-size: 12px;">
                        Market data is simulated for demonstration purposes. Updated every 5 seconds.
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 40px;">
                <div class="card-header">
                    <h3 class="card-title">Platform Capabilities</h3>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
                        <div style="text-align: center; padding: 20px; border-right: 1px solid #f0f0f0;">
                            <div style="width: 60px; height: 60px; background: #e6f7ff; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 24px; font-weight: bold; color: #1890ff;">$</div>
                            <h4 style="color: #001529; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">Financial Modeling</h4>
                            <p style="color: #666; font-size: 14px; line-height: 1.6;">
                                DCF, Comparable Analysis, and Precedent Transactions with 
                                comprehensive sensitivity analysis
                            </p>
                        </div>
                        <div style="text-align: center; padding: 20px; border-right: 1px solid #f0f0f0;">
                            <div style="width: 60px; height: 60px; background: #fff7e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 24px; font-weight: bold; color: #faad14;">!</div>
                            <h4 style="color: #001529; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">Risk Assessment</h4>
                            <p style="color: #666; font-size: 14px; line-height: 1.6;">
                                AI-powered inconsistency detection, risk categorization, 
                                and mitigation recommendations
                            </p>
                        </div>
                        <div style="text-align: center; padding: 20px;">
                            <div style="width: 60px; height: 60px; background: #f6ffed; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 24px; font-weight: bold; color: #52c41a;">≡</div>
                            <h4 style="color: #001529; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">Document Processing</h4>
                            <p style="color: #666; font-size: 14px; line-height: 1.6;">
                                Automated extraction from financial statements, memos, 
                                and unstructured documents
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">How It Works</h3>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div style="text-align: center; padding: 16px;">
                            <div style="width: 60px; height: 60px; background: #e6f7ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 24px; font-weight: bold; color: #1890ff;">1</div>
                            <h4 style="margin: 0 0 8px 0; font-size: 16px;">Upload Documents</h4>
                            <p style="color: #666; font-size: 13px;">Financial statements, memos, and reports</p>
                        </div>
                        <div style="text-align: center; padding: 16px;">
                            <div style="width: 60px; height: 60px; background: #e6f7ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 24px; font-weight: bold; color: #1890ff;">2</div>
                            <h4 style="margin: 0 0 8px 0; font-size: 16px;">AI Processing</h4>
                            <p style="color: #666; font-size: 13px;">Automated data extraction and analysis</p>
                        </div>
                        <div style="text-align: center; padding: 16px;">
                            <div style="width: 60px; height: 60px; background: #e6f7ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 24px; font-weight: bold; color: #1890ff;">3</div>
                            <h4 style="margin: 0 0 8px 0; font-size: 16px;">Valuation Models</h4>
                            <p style="color: #666; font-size: 13px;">DCF, Comps, and Precedent analysis</p>
                        </div>
                        <div style="text-align: center; padding: 16px;">
                            <div style="width: 60px; height: 60px; background: #e6f7ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 24px; font-weight: bold; color: #1890ff;">4</div>
                            <h4 style="margin: 0 0 8px 0; font-size: 16px;">Investment Decision</h4>
                            <p style="color: #666; font-size: 13px;">Comprehensive reports and recommendations</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Key Features</h3>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <h4 style="color: #001529; margin: 0 0 12px 0;">Valuation Analysis</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2; color: #666;">
                                <li>Discounted Cash Flow (DCF) with 5-year projections</li>
                                <li>Comparable Company Analysis (Trading Multiples)</li>
                                <li>Precedent Transactions (M&A Multiples)</li>
                                <li>Sensitivity Analysis (Growth, Margins, Discount Rate)</li>
                                <li>Enterprise Value Range Estimation</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #001529; margin: 0 0 12px 0;">Risk & Due Diligence</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2; color: #666;">
                                <li>Inconsistency Detection Across Documents</li>
                                <li>Risk Categorization (High/Medium/Low)</li>
                                <li>Financial Health Assessment</li>
                                <li>Customer Concentration Analysis</li>
                                <li>Deal Structure Recommendations</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px; padding: 50px; background: linear-gradient(135deg, #001529 0%, #1890ff 100%); border-radius: 12px; color: white; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                <h3 style="margin: 0 0 16px 0; font-size: 28px; font-weight: 600;">Ready to Analyze Your Next Deal?</h3>
                <p style="margin: 0 0 32px 0; font-size: 16px; opacity: 0.9; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Upload financial statements and documents to receive comprehensive valuation and risk analysis
                </p>
                <button onclick="openCompanyModal()" style="background: white; color: #1890ff; border: none; padding: 16px 40px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                    Get Started
                </button>
            </div>
        </section>

        <!-- Upload Section -->
        <section id="upload" class="section hidden">
            <h2 class="section-title">Upload Financial Documents</h2>
            <p style="color: #666; margin-bottom: 24px;">Upload your financial statements and documents for comprehensive analysis</p>
            
            <div class="card" style="margin-bottom: 24px; border: 2px solid #1890ff;">
                <div class="card-header" style="background: linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%);">
                    <h3 class="card-title" style="color: #001529;">Required Documents for In-Depth Analysis</h3>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: #f6ffed; padding: 16px; border-radius: 8px; border-left: 4px solid #52c41a;">
                            <h4 style="margin: 0 0 12px 0; color: #52c41a; text-transform: uppercase; font-size: 14px; letter-spacing: 0.5px;">Minimum</h4>
                            <p style="font-size: 13px; color: #666; margin-bottom: 12px; font-weight: 600;">Basic Valuation</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8; font-size: 14px;">
                                <li><strong>Financial Statements</strong><br/>
                                    <small style="color: #666;">CSV/Excel with Revenue, EBITDA, Net Income (2-3 years)</small>
                                </li>
                            </ul>
                            <div style="margin-top: 12px; padding: 8px; background: rgba(255,255,255,0.6); border-radius: 4px; font-size: 12px;">
                                <strong>Output:</strong> DCF, Comps, Precedent valuations
                            </div>
                        </div>
                        
                        <div style="background: #fff7e6; padding: 16px; border-radius: 8px; border-left: 4px solid #faad14;">
                            <h4 style="margin: 0 0 12px 0; color: #faad14; text-transform: uppercase; font-size: 14px; letter-spacing: 0.5px;">Recommended</h4>
                            <p style="font-size: 13px; color: #666; margin-bottom: 12px; font-weight: 600;">Complete Analysis</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8; font-size: 14px;">
                                <li><strong>Financial Statements</strong><br/>
                                    <small style="color: #666;">3-5 years of data</small>
                                </li>
                                <li><strong>Investment Memo</strong><br/>
                                    <small style="color: #666;">PDF/Word/TXT with business overview</small>
                                </li>
                            </ul>
                            <div style="margin-top: 12px; padding: 8px; background: rgba(255,255,255,0.6); border-radius: 4px; font-size: 12px;">
                                <strong>Output:</strong> Full valuations + Risk analysis + Recommendations
                            </div>
                        </div>
                        
                        <div style="background: #f0f5ff; padding: 16px; border-radius: 8px; border-left: 4px solid #1890ff;">
                            <h4 style="margin: 0 0 12px 0; color: #1890ff; text-transform: uppercase; font-size: 14px; letter-spacing: 0.5px;">Comprehensive</h4>
                            <p style="font-size: 13px; color: #666; margin-bottom: 12px; font-weight: 600;">Full Due Diligence</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8; font-size: 14px;">
                                <li><strong>Financial Statements</strong></li>
                                <li><strong>Investment Memo</strong></li>
                                <li><strong>Management Notes</strong></li>
                                <li><strong>Customer List</strong></li>
                            </ul>
                            <div style="margin-top: 12px; padding: 8px; background: rgba(255,255,255,0.6); border-radius: 4px; font-size: 12px;">
                                <strong>Output:</strong> Everything + Inconsistency detection
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #fffbe6; padding: 16px; border-radius: 8px; border: 1px solid #ffe58f;">
                        <h4 style="margin: 0 0 8px 0; color: #001529; font-weight: 600;">Document Format Requirements</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">
                            <div>
                                <strong style="color: #001529;">Financial Statements (CSV/Excel):</strong>
                                <ul style="margin: 4px 0 0 20px; line-height: 1.6;">
                                    <li>Column: <code>Year</code> or <code>Period</code></li>
                                    <li>Column: <code>Revenue</code> or <code>Sales</code></li>
                                    <li>Column: <code>EBITDA</code> or <code>Operating Income</code></li>
                                    <li>Column: <code>Net Income</code></li>
                                    <li>Optional: <code>Total Assets</code>, <code>Total Debt</code>, <code>Equity</code></li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: #001529;">Investment Memo (PDF/Word/TXT):</strong>
                                <ul style="margin: 4px 0 0 20px; line-height: 1.6;">
                                    <li>Business overview and description</li>
                                    <li>Financial performance narrative</li>
                                    <li>Market opportunity and strategy</li>
                                    <li>Risk factors and challenges</li>
                                    <li>Management team information</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px; padding: 12px; background: #f0f0f0; border-radius: 6px; text-align: center;">
                        <strong style="color: #001529;">Quick Start:</strong> <span style="color: #666;">Use the provided sample files in <code>sample_data/</code> folder for a complete demo</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">File Upload & Processing</h3>
                </div>
                <div class="card-content">
                    <div class="upload-area" id="uploadArea">
                        <div style="width: 80px; height: 80px; background: #e6f7ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 32px; font-weight: bold; color: #1890ff;">+</div>
                        <h3 style="color: #001529; margin-bottom: 8px;">Drag & Drop files here or click to browse</h3>
                        <p style="color: #666;">Supported formats: PDF, DOCX, XLSX, CSV, TXT (Maximum 16MB per file)</p>
                        <input type="file" id="fileInput" multiple style="display: none;" accept=".pdf,.docx,.xlsx,.csv,.txt">
                    </div>
                    
                    <ul class="file-list" id="fileList"></ul>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" id="analyzeBtn" onclick="runAnalysis()" disabled style="text-transform: uppercase; letter-spacing: 1px;">
                            Run Complete Analysis
                        </button>
                    </div>
                    
                    <div id="loadingArea" class="hidden">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Processing files and generating analysis...</p>
                            <p id="statusText">Uploading files...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section hidden">
            <h2 class="section-title">Investment Analysis Dashboard</h2>
            
            <div id="dashboardContent"></div>
        </section>

        <!-- Valuation Section -->
        <section id="valuation" class="section hidden">
            <h2 class="section-title">Financial Valuation Analysis</h2>
            
            <div id="valuationContent"></div>
        </section>

        <!-- Risk Section -->
        <section id="risks" class="section hidden">
            <h2 class="section-title">Risk Assessment & Due Diligence</h2>
            
            <div id="risksContent"></div>
        </section>
    </div>

    <footer style="background: #001529; color: white; padding: 40px 0; margin-top: 60px;">
        <div class="container">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 40px; margin-bottom: 24px;">
                <div>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="width: 40px; height: 40px; background: white; color: #1890ff; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px;">M</div>
                        <div>
                            <h3 style="margin: 0; font-size: 20px; letter-spacing: -0.5px;">MONTBRIDGE</h3>
                            <p style="margin: 0; font-size: 11px; opacity: 0.7; letter-spacing: 1px;">DUE DILIGENCE & VALUATION</p>
                        </div>
                    </div>
                    <p style="opacity: 0.8; line-height: 1.6; font-size: 14px;">
                        Professional investment analysis platform for private equity firms. 
                        Accelerating deal evaluation through AI-powered due diligence and 
                        comprehensive financial modeling.
                    </p>
                </div>
                <div>
                    <h4 style="margin: 0 0 16px 0; font-size: 16px;">Platform</h4>
                    <ul style="list-style: none; padding: 0; margin: 0; line-height: 2; opacity: 0.8; font-size: 14px;">
                        <li><a href="#" onclick="showSection('welcome'); return false;" style="color: white; text-decoration: none;">Home</a></li>
                        <li><a href="#" onclick="showSection('upload'); return false;" style="color: white; text-decoration: none;">Upload & Analyze</a></li>
                        <li><a href="#" onclick="showSection('dashboard'); return false;" style="color: white; text-decoration: none;">Dashboard</a></li>
                        <li><a href="#" onclick="showSection('valuation'); return false;" style="color: white; text-decoration: none;">Valuation</a></li>
                        <li><a href="#" onclick="showSection('risks'); return false;" style="color: white; text-decoration: none;">Risk Assessment</a></li>
                    </ul>
                </div>
                <div>
                    <h4 style="margin: 0 0 16px 0; font-size: 16px;">Analysis Methods</h4>
                    <ul style="list-style: none; padding: 0; margin: 0; line-height: 2; opacity: 0.8; font-size: 14px;">
                        <li>DCF Valuation</li>
                        <li>Comparable Analysis</li>
                        <li>Precedent Transactions</li>
                        <li>Sensitivity Analysis</li>
                        <li>Risk Assessment</li>
                    </ul>
                </div>
            </div>
            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 24px; text-align: center; opacity: 0.6; font-size: 13px;">
                <p style="margin: 0;">© 2025 Montbridge Due Diligence & Valuation Platform. Built for Private Equity Investment Analysis.</p>
                <p style="margin: 8px 0 0 0;">University Project - Demonstrating AI-Powered Due Diligence Capabilities</p>
            </div>
        </div>
    </footer>

    <!-- Company Name Modal -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Begin New Analysis</h2>
                <p style="color: #666; margin: 0;">Enter the target company name to begin due diligence</p>
            </div>
            <div class="form-group">
                <label class="form-label">Company Name</label>
                <input type="text" id="companyNameInput" class="form-input" placeholder="e.g., Technology Solutions Inc." />
            </div>
            <div class="form-group">
                <label class="form-label">Industry (Optional)</label>
                <input type="text" id="industryInput" class="form-input" placeholder="e.g., Software, Manufacturing, Retail" />
            </div>
            <div class="btn-group">
                <button onclick="closeCompanyModal()" style="background: #f0f0f0; color: #666; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                    Cancel
                </button>
                <button onclick="startAnalysis()" class="btn" style="padding: 10px 24px;">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5001/api';
        let uploadedFiles = [];
        let analysisResults = null;
        let companyName = '';
        let industry = '';
        let currentMarket = 'us';
        
        // Market data configuration
        const marketData = {
            us: [
                { symbol: 'S&P 500', name: 'S&P 500 Index', price: 4783.45, basePrice: 4783.45 },
                { symbol: 'DJIA', name: 'Dow Jones Industrial', price: 37545.33, basePrice: 37545.33 },
                { symbol: 'NASDAQ', name: 'NASDAQ Composite', price: 14895.23, basePrice: 14895.23 },
                { symbol: 'AAPL', name: 'Apple Inc.', price: 189.95, basePrice: 189.95 },
                { symbol: 'MSFT', name: 'Microsoft Corp.', price: 378.91, basePrice: 378.91 },
                { symbol: 'GOOGL', name: 'Alphabet Inc.', price: 141.80, basePrice: 141.80 },
                { symbol: 'AMZN', name: 'Amazon.com Inc.', price: 155.33, basePrice: 155.33 },
                { symbol: 'TSLA', name: 'Tesla Inc.', price: 242.84, basePrice: 242.84 }
            ],
            europe: [
                { symbol: 'FTSE 100', name: 'FTSE 100 Index', price: 7733.24, basePrice: 7733.24 },
                { symbol: 'DAX', name: 'DAX Index', price: 16427.86, basePrice: 16427.86 },
                { symbol: 'CAC 40', name: 'CAC 40 Index', price: 7486.55, basePrice: 7486.55 },
                { symbol: 'SAP', name: 'SAP SE', price: 145.25, basePrice: 145.25 },
                { symbol: 'ASML', name: 'ASML Holding', price: 745.60, basePrice: 745.60 },
                { symbol: 'LVMH', name: 'LVMH', price: 725.30, basePrice: 725.30 },
                { symbol: 'NVO', name: 'Novo Nordisk', price: 98.45, basePrice: 98.45 },
                { symbol: 'SIE', name: 'Siemens AG', price: 168.75, basePrice: 168.75 }
            ],
            asia: [
                { symbol: 'NIKKEI', name: 'Nikkei 225', price: 33464.17, basePrice: 33464.17 },
                { symbol: 'HSI', name: 'Hang Seng Index', price: 16830.30, basePrice: 16830.30 },
                { symbol: 'KOSPI', name: 'KOSPI Index', price: 2599.42, basePrice: 2599.42 },
                { symbol: 'TSM', name: 'Taiwan Semiconductor', price: 105.75, basePrice: 105.75 },
                { symbol: '005930', name: 'Samsung Electronics', price: 71.20, basePrice: 71.20 },
                { symbol: 'BABA', name: 'Alibaba Group', price: 78.90, basePrice: 78.90 },
                { symbol: 'SONY', name: 'Sony Group Corp', price: 95.40, basePrice: 95.40 },
                { symbol: 'NIO', name: 'NIO Inc.', price: 8.65, basePrice: 8.65 }
            ],
            tech: [
                { symbol: 'AAPL', name: 'Apple Inc.', price: 189.95, basePrice: 189.95 },
                { symbol: 'MSFT', name: 'Microsoft Corp.', price: 378.91, basePrice: 378.91 },
                { symbol: 'NVDA', name: 'NVIDIA Corp.', price: 495.22, basePrice: 495.22 },
                { symbol: 'META', name: 'Meta Platforms', price: 346.29, basePrice: 346.29 },
                { symbol: 'GOOGL', name: 'Alphabet Inc.', price: 141.80, basePrice: 141.80 },
                { symbol: 'AMZN', name: 'Amazon.com', price: 155.33, basePrice: 155.33 },
                { symbol: 'TSLA', name: 'Tesla Inc.', price: 242.84, basePrice: 242.84 },
                { symbol: 'CRM', name: 'Salesforce Inc.', price: 267.54, basePrice: 267.54 }
            ]
        };
        
        function switchMarket(market) {
            currentMarket = market;
            updateMarketDisplay();
        }
        
        function updateMarketDisplay() {
            const marketDataEl = document.getElementById('marketData');
            if (!marketDataEl) return;
            
            const stocks = marketData[currentMarket];
            
            marketDataEl.innerHTML = stocks.map(stock => {
                const change = ((stock.price - stock.basePrice) / stock.basePrice * 100);
                const isPositive = change >= 0;
                const changeColor = isPositive ? '#10b981' : '#ef4444';
                const arrow = isPositive ? '▲' : '▼';
                
                return `
                    <div style="background: #f9fafb; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb; transition: all 0.2s;" onmouseover="this.style.borderColor='#0066cc'" onmouseout="this.style.borderColor='#e5e7eb'">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <div style="font-size: 14px; font-weight: 700; color: #111827;">${stock.symbol}</div>
                                <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">${stock.name}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 16px; font-weight: 700; color: #111827;">$${stock.price.toFixed(2)}</div>
                                <div style="font-size: 12px; font-weight: 600; color: ${changeColor};">
                                    ${arrow} ${Math.abs(change).toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div style="height: 2px; background: #e5e7eb; border-radius: 1px; overflow: hidden; margin-top: 8px;">
                            <div style="height: 100%; width: ${Math.min(Math.abs(change) * 10, 100)}%; background: ${changeColor}; transition: width 0.5s;"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function simulateMarketMovement() {
            Object.keys(marketData).forEach(market => {
                marketData[market].forEach(stock => {
                    // Simulate small price movements (-0.5% to +0.5%)
                    const movement = (Math.random() - 0.5) * 0.01;
                    stock.price = stock.price * (1 + movement);
                });
            });
            
            if (document.getElementById('marketData') && !document.getElementById('welcome').classList.contains('hidden')) {
                updateMarketDisplay();
            }
        }
        
        // Initialize market data on page load
        setTimeout(() => {
            updateMarketDisplay();
            // Update market data every 5 seconds
            setInterval(simulateMarketMovement, 5000);
        }, 100);

        // Modal functions
        function openCompanyModal() {
            document.getElementById('companyModal').classList.add('active');
            document.getElementById('companyNameInput').focus();
        }

        function closeCompanyModal() {
            document.getElementById('companyModal').classList.remove('active');
        }

        function startAnalysis() {
            companyName = document.getElementById('companyNameInput').value.trim();
            industry = document.getElementById('industryInput').value.trim();
            
            if (!companyName) {
                alert('Please enter a company name');
                return;
            }
            
            closeCompanyModal();
            showSection('upload');
            
            // Update page title with company name
            document.querySelector('.section-title').textContent = `Upload Financial Documents - ${companyName}`;
        }

        // File upload handling - Initialize after DOM is ready
        let uploadArea, fileInput, fileList, analyzeBtn;
        
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            uploadArea = document.getElementById('uploadArea');
            fileInput = document.getElementById('fileInput');
            fileList = document.getElementById('fileList');
            analyzeBtn = document.getElementById('analyzeBtn');

            if (uploadArea && fileInput) {
                uploadArea.addEventListener('click', () => fileInput.click());
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                uploadArea.addEventListener('drop', handleFileDrop);
                fileInput.addEventListener('change', handleFileSelect);
            }
        });

        function handleFileDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer && e.dataTransfer.files) {
                const files = Array.from(e.dataTransfer.files);
                addFiles(files);
            }
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            addFiles(files);
        }

        function addFiles(files) {
            if (!files || files.length === 0) return;
            
            Array.from(files).forEach(file => {
                if (!uploadedFiles.find(f => f.name === file.name)) {
                    uploadedFiles.push(file);
                }
            });
            updateFileList();
        }

        function updateFileList() {
            if (!fileList) {
                console.error('File list element not found');
                return;
            }
            
            fileList.innerHTML = '';
            uploadedFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <span><strong>${file.name}</strong> <small style="color: #666;">(${formatFileSize(file.size)})</small></span>
                    <button onclick="removeFile(${index})" style="background: #ff4d4f; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer;">Remove</button>
                `;
                fileList.appendChild(li);
            });
            
            if (analyzeBtn) {
                analyzeBtn.disabled = uploadedFiles.length === 0;
            }
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        async function runAnalysis() {
            if (uploadedFiles.length === 0) {
                alert('Please upload files first');
                return;
            }

            document.getElementById('loadingArea').classList.remove('hidden');
            analyzeBtn.disabled = true;

            try {
                // Step 1: Upload files
                updateStatus('Uploading files...');
                const formData = new FormData();
                uploadedFiles.forEach(file => formData.append('files', file));

                const uploadResponse = await axios.post(`${API_URL}/upload`, formData);
                const filePaths = uploadResponse.data.uploaded_files.map(f => f.filepath);

                // Step 2: Process files
                updateStatus('Processing documents and extracting data...');
                const processResponse = await axios.post(`${API_URL}/process`, {
                    file_paths: filePaths
                });

                // Step 3: Extract financial data from processed files
                updateStatus('Extracting financial metrics...');
                const financialData = extractFinancialData(processResponse.data.structured_data);
                
                // Step 4: Generate valuation
                updateStatus('Generating financial models and valuations (DCF, Comps, Precedent)...');
                const valuationResponse = await axios.post(`${API_URL}/valuation`, {
                    financial_data: financialData,
                    assumptions: {
                        terminal_growth_rate: 0.025,
                        discount_rate: 0.12,
                        tax_rate: 0.25
                    }
                });

                // Step 4: Analyze risks
                updateStatus('Conducting risk analysis and due diligence...');
                const riskResponse = await axios.post(`${API_URL}/risk-analysis`, {
                    structured_data: processResponse.data.structured_data,
                    unstructured_data: processResponse.data.unstructured_data,
                    extracted_info: processResponse.data.extracted_info
                });

                // Step 5: Get dashboard data
                updateStatus('Preparing dashboard...');
                const dashboardResponse = await axios.post(`${API_URL}/dashboard`, {
                    valuation_results: valuationResponse.data,
                    risk_analysis: riskResponse.data
                });

                analysisResults = {
                    valuation: valuationResponse.data,
                    risks: riskResponse.data,
                    dashboard: dashboardResponse.data
                };

                // Display results
                displayDashboard();
                displayValuation();
                displayRisks();

                // Show dashboard
                showSection('dashboard');

                alert('Analysis completed successfully!');

            } catch (error) {
                console.error('Analysis error:', error);
                console.error('Error details:', error.response?.data);
                
                let errorMessage = 'Analysis failed. ';
                if (error.response?.data?.error) {
                    errorMessage += error.response.data.error;
                } else if (error.message) {
                    errorMessage += error.message;
                } else {
                    errorMessage += 'Please check the console for details.';
                }
                
                alert(errorMessage + '\n\nMake sure your CSV file has columns: Year, Revenue, EBITDA (or Net Income)');
            } finally {
                document.getElementById('loadingArea').classList.add('hidden');
                analyzeBtn.disabled = false;
            }
        }

        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update active nav item
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function downloadReport() {
            if (!analysisResults) {
                alert('No analysis results available. Please run an analysis first.');
                return;
            }

            try {
                const { valuation, risks } = analysisResults;
                const date = new Date().toLocaleDateString();
                
                // Safe data extraction with defaults
                const dcfVal = valuation?.dcf_valuation?.value || 0;
                const compsVal = valuation?.comparable_analysis?.value || 0;
                const precedentVal = valuation?.precedent_transactions?.value || 0;
                const rangeLow = valuation?.valuation_range?.low || dcfVal;
                const rangeHigh = valuation?.valuation_range?.high || Math.max(dcfVal, compsVal, precedentVal);
                
                const highRisks = risks?.high_risks || [];
                const mediumRisks = risks?.medium_risks || [];
                const lowRisks = risks?.low_risks || [];
                const totalRisks = highRisks.length + mediumRisks.length + lowRisks.length;
                
                // Generate comprehensive report text
                let reportText = `
MONTBRIDGE DUE DILIGENCE & VALUATION PLATFORM
Investment Analysis Report
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

TARGET COMPANY: ${companyName || 'N/A'}
INDUSTRY: ${industry || 'N/A'}
ANALYSIS DATE: ${date}
PREPARED BY: Montbridge Platform

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

EXECUTIVE SUMMARY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Enterprise Value Range: $${formatNumber(rangeLow)} - $${formatNumber(rangeHigh)}
Risk Profile: ${highRisks.length} High, ${mediumRisks.length} Medium, ${lowRisks.length} Low
Overall Risk Score: ${calculateRiskScore(risks)}/100
Total Risk Factors Identified: ${totalRisks}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

VALUATION ANALYSIS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. DISCOUNTED CASH FLOW (DCF)
   Enterprise Value: $${formatNumber(dcfVal)}
   
   ${valuation?.dcf_valuation?.projected_cash_flows ? `Projected Cash Flows (5 Years):
${valuation.dcf_valuation.projected_cash_flows.map((cf, i) => `   Year ${i+1}: $${formatNumber(cf)}`).join('\n')}
   
   Terminal Value: $${formatNumber(valuation.dcf_valuation.terminal_value)}
   Discounted Terminal Value: $${formatNumber(valuation.dcf_valuation.discounted_terminal_value)}` : 'Cash flow projections not available'}
   
   ${valuation?.dcf_valuation?.assumptions ? `Key Assumptions:
   - Discount Rate (WACC): ${(valuation.dcf_valuation.assumptions.discount_rate * 100).toFixed(1)}%
   - Terminal Growth Rate: ${(valuation.dcf_valuation.assumptions.terminal_growth_rate * 100).toFixed(1)}%
   - Tax Rate: ${(valuation.dcf_valuation.assumptions.tax_rate * 100).toFixed(1)}%` : ''}

2. COMPARABLE COMPANY ANALYSIS
   Enterprise Value: $${formatNumber(compsVal)}
   
   ${valuation?.comparable_analysis?.industry_multiples ? `Multiples Applied:
   - EV/Revenue: ${valuation.comparable_analysis.industry_multiples['EV/Revenue']}x
   - EV/EBITDA: ${valuation.comparable_analysis.industry_multiples['EV/EBITDA']}x` : 'Industry multiples applied'}

3. PRECEDENT TRANSACTIONS
   Enterprise Value: $${formatNumber(precedentVal)}
   
   ${valuation?.precedent_transactions?.precedent_multiples ? `Multiples Applied (with control premium):
   - EV/Revenue: ${valuation.precedent_transactions.precedent_multiples['EV/Revenue']}x
   - EV/EBITDA: ${valuation.precedent_transactions.precedent_multiples['EV/EBITDA']}x` : 'Acquisition multiples applied'}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

RISK ASSESSMENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

HIGH RISKS (${highRisks.length}):
${highRisks.length > 0 ? highRisks.map(r => `- ${r.type || 'Risk'}: ${r.description || 'No description'}`).join('\n') : '- None identified'}

MEDIUM RISKS (${mediumRisks.length}):
${mediumRisks.length > 0 ? mediumRisks.map(r => `- ${r.type || 'Risk'}: ${r.description || 'No description'}`).join('\n') : '- None identified'}

LOW RISKS (${lowRisks.length}):
${lowRisks.length > 0 ? lowRisks.map(r => `- ${r.type || 'Risk'}: ${r.description || 'No description'}`).join('\n') : '- None identified'}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

RECOMMENDATIONS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

${risks?.recommendations ? risks.recommendations.map(rec => `
${rec.category}:
${rec.recommendations.map(r => `  - ${r}`).join('\n')}
`).join('\n') : `
DEAL STRUCTURE CONSIDERATIONS:
- Conduct comprehensive due diligence on identified risk factors
- Consider risk-adjusted valuation within the estimated range
- Structure appropriate representations and warranties
- Implement monitoring mechanisms for key risk areas
`}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CONCLUSION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Based on our comprehensive analysis, ${companyName || 'the target company'} presents an enterprise value 
range of $${formatNumber(rangeLow)} to $${formatNumber(rangeHigh)}.

The target company exhibits a ${calculateRiskScore(risks) > 70 ? 'HIGH' : calculateRiskScore(risks) > 40 ? 'MODERATE' : 'LOW'} 
risk profile with ${totalRisks} identified risk factors.

Recommendation: ${calculateRiskScore(risks) > 70 ? 'Proceed with caution and enhanced due diligence' : 
                  calculateRiskScore(risks) > 40 ? 'Proceed with standard due diligence' : 
                  'Favorable candidate for acquisition'}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

VALUATION SUMMARY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

DCF Valuation:                  $${formatNumber(dcfVal)}
Comparable Company Analysis:    $${formatNumber(compsVal)}
Precedent Transactions:         $${formatNumber(precedentVal)}

Recommended Valuation Range:    $${formatNumber(rangeLow)} - $${formatNumber(rangeHigh)}
Mid-Point Valuation:            $${formatNumber((rangeLow + rangeHigh) / 2)}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

This report was generated by Montbridge Due Diligence & Valuation Platform
For internal use only - Confidential

Generated: ${new Date().toLocaleString()}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
`;

                // Create and download file
                const blob = new Blob([reportText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const fileName = `Montbridge_Analysis_${(companyName || 'Company').replace(/\s+/g, '_')}_${date.replace(/\//g, '-')}.txt`;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`Report downloaded: ${fileName}`);
                
            } catch (error) {
                console.error('Download error:', error);
                alert('Error generating report: ' + error.message);
            }
        }

        function calculateRiskScore(risks) {
            return (risks.high_risks.length * 10) + (risks.medium_risks.length * 5) + (risks.low_risks.length * 2);
        }

        function displayDashboard() {
            const content = document.getElementById('dashboardContent');
            const { valuation, risks, dashboard } = analysisResults;

            // Safe value extraction with defaults
            const dcfValue = valuation.dcf_valuation?.value || 0;
            const compsValue = valuation.comparable_analysis?.value || 0;
            const precedentValue = valuation.precedent_transactions?.value || 0;
            const totalRisks = (risks.high_risks?.length || 0) + (risks.medium_risks?.length || 0) + (risks.low_risks?.length || 0);

            content.innerHTML = `
                <div class="alert alert-info" style="margin-bottom: 24px;">
                    <strong style="color: #001529;">Analysis Complete for ${companyName}</strong>
                    ${industry ? ` | Industry: ${industry}` : ''}
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">$${formatNumber(dcfValue)}</div>
                        <div class="metric-label">DCF Valuation</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">$${formatNumber(compsValue)}</div>
                        <div class="metric-label">Comparable Analysis</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">$${formatNumber(precedentValue)}</div>
                        <div class="metric-label">Precedent Transactions</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${totalRisks}</div>
                        <div class="metric-label">Risk Factors</div>
                    </div>
                </div>

                <div class="download-section">
                    <h3 style="margin: 0 0 12px 0; color: #001529; font-size: 20px;">Download Complete Analysis Report</h3>
                    <p style="color: #666; margin: 0 0 20px 0;">
                        Generate a comprehensive text report with all valuation details, risk assessment, and recommendations
                    </p>
                    <button onclick="downloadReport()" class="btn" style="padding: 14px 32px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px;">
                        Download Report
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Valuation Methods Comparison</h3>
                    </div>
                    <div class="card-content">
                        <div class="chart-container">
                            <canvas id="dashValChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Risk Distribution</h3>
                    </div>
                    <div class="card-content">
                        <div class="chart-container">
                            <canvas id="dashRiskChart"></canvas>
                        </div>
                    </div>
                </div>
            `;

            // Draw charts
            setTimeout(() => {
                new Chart(document.getElementById('dashValChart'), {
                    type: 'bar',
                    data: {
                        labels: ['DCF', 'Comparable', 'Precedent'],
                        datasets: [{
                            label: 'Valuation ($)',
                            data: [
                                dcfValue,
                                compsValue,
                                precedentValue
                            ],
                            backgroundColor: ['#1890ff', '#52c41a', '#faad14']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return '$' + formatNumber(value);
                                    }
                                }
                            }
                        }
                    }
                });

                new Chart(document.getElementById('dashRiskChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['High Risk', 'Medium Risk', 'Low Risk'],
                        datasets: [{
                            data: [
                                risks.high_risks?.length || 0,
                                risks.medium_risks?.length || 0,
                                risks.low_risks?.length || 0
                            ],
                            backgroundColor: ['#ff4d4f', '#faad14', '#52c41a']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }, 100);
        }

        function displayValuation() {
            const content = document.getElementById('valuationContent');
            const { valuation } = analysisResults;
            const dcf = valuation.dcf_valuation;
            const comps = valuation.comparable_analysis;
            const precedent = valuation.precedent_transactions;

            content.innerHTML = `
                <div class="alert alert-success">
                    <strong style="color: #001529;">Valuation Complete for ${companyName}:</strong> Enterprise value estimated at $${formatNumber(valuation.valuation_range.low)} - $${formatNumber(valuation.valuation_range.high)}
                </div>

                <div class="download-section">
                    <h3 style="margin: 0 0 12px 0; color: #001529; font-size: 20px;">Download Complete Analysis Report</h3>
                    <p style="color: #666; margin: 0 0 20px 0;">
                        Generate a comprehensive report with all valuation details, risk assessment, and recommendations for ${companyName}
                    </p>
                    <button onclick="downloadReport()" class="btn" style="padding: 14px 32px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px;">
                        Download Report
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Valuation Summary</h3>
                    </div>
                    <div class="card-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Enterprise Value</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Discounted Cash Flow (DCF)</strong></td>
                                    <td style="color: #1890ff; font-size: 18px;"><strong>$${formatNumber(dcf.value)}</strong></td>
                                    <td>Present value of projected future cash flows</td>
                                </tr>
                                <tr>
                                    <td><strong>Comparable Company Analysis</strong></td>
                                    <td style="color: #52c41a; font-size: 18px;"><strong>$${formatNumber(comps.value)}</strong></td>
                                    <td>Based on industry trading multiples (EV/Revenue: ${comps.industry_multiples ? comps.industry_multiples['EV/Revenue'] : 'N/A'}x, EV/EBITDA: ${comps.industry_multiples ? comps.industry_multiples['EV/EBITDA'] : 'N/A'}x)</td>
                                </tr>
                                <tr>
                                    <td><strong>Precedent Transactions</strong></td>
                                    <td style="color: #faad14; font-size: 18px;"><strong>$${formatNumber(precedent.value)}</strong></td>
                                    <td>Based on acquisition multiples (EV/Revenue: ${precedent.precedent_multiples ? precedent.precedent_multiples['EV/Revenue'] : 'N/A'}x, EV/EBITDA: ${precedent.precedent_multiples ? precedent.precedent_multiples['EV/EBITDA'] : 'N/A'}x)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">DCF Model - Detailed Breakdown</h3>
                    </div>
                    <div class="card-content">
                        <h4>Projected Cash Flows (5 Years):</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Year</th>
                                    <th>Projected Free Cash Flow</th>
                                    <th>Discounted Cash Flow</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${dcf.projected_cash_flows.map((cf, i) => `
                                    <tr>
                                        <td>Year ${i + 1}</td>
                                        <td>$${formatNumber(cf)}</td>
                                        <td>$${formatNumber(dcf.discounted_cash_flows[i])}</td>
                                    </tr>
                                `).join('')}
                                <tr style="background: #fafafa; font-weight: bold;">
                                    <td>Terminal Value</td>
                                    <td>$${formatNumber(dcf.terminal_value)}</td>
                                    <td>$${formatNumber(dcf.discounted_terminal_value)}</td>
                                </tr>
                                <tr style="background: #e6f7ff; font-weight: bold; color: #1890ff;">
                                    <td colspan="2">Total Enterprise Value</td>
                                    <td>$${formatNumber(dcf.value)}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Key Valuation Assumptions</h3>
                    </div>
                    <div class="card-content">
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-value">${(dcf.assumptions.terminal_growth_rate * 100).toFixed(1)}%</div>
                                <div class="metric-label">Terminal Growth Rate</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">${(dcf.assumptions.discount_rate * 100).toFixed(1)}%</div>
                                <div class="metric-label">Discount Rate (WACC)</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">${(dcf.assumptions.tax_rate * 100).toFixed(1)}%</div>
                                <div class="metric-label">Tax Rate</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">5 Years</div>
                                <div class="metric-label">Projection Period</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Sensitivity Analysis</h3>
                    </div>
                    <div class="card-content">
                        <canvas id="sensitivityChart" style="height: 300px;"></canvas>
                    </div>
                </div>
            `;

            // Draw sensitivity chart
            setTimeout(() => {
                const sens = valuation.sensitivity_analysis;
                if (sens && sens.sensitivity_scenarios) {
                    new Chart(document.getElementById('sensitivityChart'), {
                        type: 'line',
                        data: {
                            labels: sens.sensitivity_scenarios.growth_rate.map(s => `${(s.growth_rate * 100).toFixed(1)}%`),
                            datasets: [{
                                label: 'Valuation by Growth Rate',
                                data: sens.sensitivity_scenarios.growth_rate.map(s => s.value),
                                borderColor: '#1890ff',
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Impact of Growth Rate Changes on Valuation'
                                }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + formatNumber(value);
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
        }

        function displayRisks() {
            const content = document.getElementById('risksContent');
            const { risks } = analysisResults;

            let risksHTML = `
                <div class="alert alert-info" style="margin-bottom: 24px;">
                    <strong style="color: #001529;">Risk Assessment Complete for ${companyName}</strong>
                    ${industry ? ` | Industry: ${industry}` : ''}
                </div>

                <div class="download-section">
                    <h3 style="margin: 0 0 12px 0; color: #001529; font-size: 20px;">Download Complete Analysis Report</h3>
                    <p style="color: #666; margin: 0 0 20px 0;">
                        Generate a comprehensive report including all risk factors and mitigation strategies for ${companyName}
                    </p>
                    <button onclick="downloadReport()" class="btn" style="padding: 14px 32px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px;">
                        Download Report
                    </button>
                </div>
            `;
            
            ['high_risks', 'medium_risks', 'low_risks'].forEach(level => {
                const risks_list = risks[level] || [];
                const color = level === 'high_risks' ? '#ff4d4f' : level === 'medium_risks' ? '#faad14' : '#52c41a';
                const label = level.replace('_risks', '').toUpperCase();

                if (risks_list.length > 0) {
                    risksHTML += `
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" style="color: ${color}">${label} RISKS (${risks_list.length})</h3>
                            </div>
                            <div class="card-content">
                                <ul style="list-style: none;">
                                    ${risks_list.map(risk => `
                                        <li style="padding: 12px; background: ${color}22; border-left: 4px solid ${color}; margin-bottom: 8px; border-radius: 4px;">
                                            <strong>${risk.type || 'Risk'}:</strong> ${risk.description}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                }
            });

            content.innerHTML = risksHTML;
        }

        function extractFinancialData(structuredData) {
            // Extract financial metrics from uploaded files
            console.log('Structured data:', structuredData);
            
            let revenue = 1000000; // Default
            let ebitda_margin = 0.15; // Default  
            let growth_rate = 0.08; // Default
            let ebitda = null;
            let net_income = null;
            
            // Try to extract from each uploaded file
            for (const filePath in structuredData) {
                const data = structuredData[filePath];
                
                if (Array.isArray(data) && data.length > 0) {
                    // Get the most recent year (last row)
                    const latestData = data[data.length - 1];
                    const previousData = data.length > 1 ? data[data.length - 2] : null;
                    
                    console.log('Latest data:', latestData);
                    console.log('Previous data:', previousData);
                    
                    // Extract revenue (try different column names)
                    if (latestData.revenue) revenue = parseFloat(latestData.revenue);
                    else if (latestData.Revenue) revenue = parseFloat(latestData.Revenue);
                    else if (latestData.sales) revenue = parseFloat(latestData.sales);
                    else if (latestData.Sales) revenue = parseFloat(latestData.Sales);
                    
                    // Extract EBITDA
                    if (latestData.ebitda) ebitda = parseFloat(latestData.ebitda);
                    else if (latestData.EBITDA) ebitda = parseFloat(latestData.EBITDA);
                    
                    // Extract Net Income
                    if (latestData.net_income) net_income = parseFloat(latestData.net_income);
                    else if (latestData['Net Income']) net_income = parseFloat(latestData['Net Income']);
                    
                    // Calculate EBITDA margin if we have both
                    if (ebitda && revenue) {
                        ebitda_margin = ebitda / revenue;
                    }
                    
                    // Calculate growth rate if we have previous data
                    if (previousData && previousData.revenue && latestData.revenue) {
                        const prevRev = parseFloat(previousData.revenue) || parseFloat(previousData.Revenue);
                        const currRev = parseFloat(latestData.revenue) || parseFloat(latestData.Revenue);
                        if (prevRev && currRev) {
                            growth_rate = (currRev - prevRev) / prevRev;
                        }
                    } else if (latestData.growth_rate) {
                        growth_rate = parseFloat(latestData.growth_rate);
                    } else if (latestData['Growth Rate']) {
                        growth_rate = parseFloat(latestData['Growth Rate']);
                    }
                }
            }
            
            console.log('Extracted financial data:', {
                revenue,
                ebitda,
                ebitda_margin,
                growth_rate,
                net_income
            });
            
            return {
                revenue,
                ebitda,
                ebitda_margin,
                growth_rate,
                net_income
            };
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-US').format(Math.round(num));
        }
    </script>
</body>
</html>
